<html>

<head>
    <script type="text/javascript" src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>
    <style type="text/css">
        #mynetwork {
            width: 600px;
            height: 400px;
            text-align: center;
        }
    </style>
</head>

<body>
    <form id="form_get_value" method="get" action="#" onsubmit="addValToGet(event)">
        Check if value exists in the Distributed Hash Set (contains): <input type="text" name="key" id="input_get" autocomplete="off">
    </form>
    <form action="/key" method="post">
        Insert a new value in the Distributed Hash Set (insert): <input type="text" name="key" autocomplete="off">
    </form>
    <div id="mynetwork"></div>

    <script type="text/javascript">
        function addValToGet(event) {
            console.log(event);
            event.preventDefault();
            let src = "/key/" + document.getElementById("input_get").value;
            let form = document.getElementById('form_get_value');
            window.open(src,"_self");
        }
        function sleep(time) {
            return new Promise((resolve) => setTimeout(resolve, time));
        }

        function httpGet(theUrl) {
            let xmlHttp = new XMLHttpRequest();
            xmlHttp.open("GET", theUrl, false);
            // xmlHttp.responseType = 'json';
            edges = []
            nodes = []

            xmlHttp.send(null);
            let jsondata;
            try {
                jsondata = JSON.parse(xmlHttp.responseText);
            }
            catch (err) {
                console.warn(`Logged an error with ${xmlHttp.responseText}. Retrying after 1.5 seconds...`);
                sleep(1500).then(() => httpGet("/ring"));
            }
            for (i = 0; i < jsondata.length; i++) {
                let edge = { "arrows": "to" };
                let node = {};
                edge.from = jsondata[i].from;
                edge.to = jsondata[i].to;
                node.id = jsondata[i].from;
                node.label = "Node " + jsondata[i].from;
                edges[i] = edge;
                nodes[i] = node;
            }
            let n = new vis.DataSet(nodes);
            let e = new vis.DataSet(edges);
            let data = {
                nodes: n,
                edges: e
            };
            let options = {};

            let network = new vis.Network(document.getElementById('mynetwork'), data, options);

            sleep(1500).then(() => httpGet("/ring"));
        }

        httpGet("/ring");
    </script>
</body>

</html>